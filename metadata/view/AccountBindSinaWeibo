{
    "type": "Ext.Container",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "AccountBindSinaWeibo",
        "layout": "fit"
    },
    "designerId": "f0066b1a-4642-4c2d-a5d2-eae151365b2a",
    "cn": [
        {
            "type": "Ext.TitleBar",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "cls": [
                    "zjs-bg-green"
                ],
                "designer|uiInterfaceName": "zjs",
                "docked": "top",
                "title": "新浪微博账号绑定",
                "ui": "zjs"
            },
            "designerId": "3cc249df-625d-4e98-aec3-53b39180a199",
            "cn": [
                {
                    "type": "Ext.Button",
                    "reference": {
                        "name": "items",
                        "type": "array"
                    },
                    "codeClass": null,
                    "userConfig": {
                        "designer|uiInterfaceName": "plain",
                        "height": 30,
                        "icon": "",
                        "iconCls": "zjs-icon-back",
                        "itemId": "mybutton23",
                        "text": "back",
                        "ui": "plain",
                        "width": 30
                    },
                    "designerId": "97826105-39f9-498c-a26f-6e6dcf72aff4",
                    "cn": [
                        {
                            "type": "basiceventbinding",
                            "reference": {
                                "name": "listeners",
                                "type": "array"
                            },
                            "codeClass": null,
                            "userConfig": {
                                "fn": "onMybutton23Tap1",
                                "implHandler": [
                                    "pop_view();"
                                ],
                                "name": "tap"
                            },
                            "designerId": "6cba8e6a-7262-494a-9f8b-3eedeb666406"
                        }
                    ]
                }
            ]
        },
        {
            "type": "Ext.Panel",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "hidden": false,
                "itemId": "iframe_con"
            },
            "designerId": "5bcd262c-5b94-4749-9641-058e5c6dc803"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "old_init",
                "implHandler": [
                    "this.callParent();\r",
                    "\r",
                    "var _this = this;\r",
                    "\r",
                    "var platform = 'sina';\r",
                    "var iframe_src = build_api('bind_'+platform);\r",
                    "var x$toggle = x$('toggle_ab_'+platform);\r",
                    "var token = get_s('token');\r",
                    "iframe_src = iframe_src+'?token='+token+'&flag=mobile';\r",
                    "\r",
                    "\r",
                    "var init_iframe = function( $iframe ){\r",
                    "  //console.log(iframe_src);\r",
                    "  //console.log($iframe.get(0).src);\r",
                    "  $iframe.attr('src',iframe_src);\r",
                    "\r",
                    "  heart_beat_check(function(code,status){\r",
                    "\r",
                    "    switch(code){\r",
                    "      case 0:\r",
                    "        toast('恭喜你，绑定成功！');\r",
                    "        _this.up('navigationview').pop();\r",
                    "        break;\r",
                    "      case 1:\r",
                    "        toast('操作超时，请重试。');\r",
                    "        x$toggle.setValue(0);\r",
                    "        _this.up('navigationview').pop();\r",
                    "        break;\r",
                    "      case 2:\r",
                    "        toast('您的网络似乎有问题，请确认网络连接正常后再试。');\r",
                    "        x$toggle.setValue(0);\r",
                    "        _this.up('navigationview').pop();\r",
                    "        break;\r",
                    "      case 3:\r",
                    "        toast('服务器访问错误，请稍候再试。');\r",
                    "        x$toggle.setValue(0);\r",
                    "        _this.up('navigationview').pop();\r",
                    "        break;\r",
                    "    }\r",
                    "\r",
                    "\r",
                    "    console.log(status);\r",
                    "  });\r",
                    "\r",
                    "};\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "var heart_beat_check = function(callback){\r",
                    "  var timeout = 600;\r",
                    "  var beat_timeout = 30;\r",
                    "  var beat_try = 10;\r",
                    "  var start_time = (new Date()).getTime();\r",
                    "  var is_free = true;\r",
                    "  var interval_handler;\r",
                    "\r",
                    "  var err_da = ['SUCCESS','TIMEOUT','NET_TRYOUT','API_ERROR'];\r",
                    "\r",
                    "\r",
                    "  var tick_beat = function(){\r",
                    "\r",
                    "    console.log('beat_try ' + beat_try);\r",
                    "    console.log('timeout ' + timeout);\r",
                    "\r",
                    "\r",
                    "    if( timeout <= 0 ){\r",
                    "      clearInterval(interval_handler);\r",
                    "      callback(1,err_da);\r",
                    "      return;\r",
                    "    }\r",
                    "\r",
                    "    if( beat_try <= 0 ){\r",
                    "      clearInterval(interval_handler);\r",
                    "      callback(2,err_da);\r",
                    "      return;\r",
                    "    }\r",
                    "\r",
                    "    is_free = false;\r",
                    "\r",
                    "    send_request( {\r",
                    "      api:'check_bind',\r",
                    "      method:'POST',\r",
                    "      params:{\r",
                    "        platform:platform\r",
                    "      },\r",
                    "      success:function(result, request){\r",
                    "        is_free = true;\r",
                    "        if( result.code == '0000' ){\r",
                    "          if( result.result ){\r",
                    "            clearInterval(interval_handler);\r",
                    "            callback(0,err_da);\r",
                    "            return;\r",
                    "          }\r",
                    "        }else{\r",
                    "          clearInterval(interval_handler);\r",
                    "          callback(3,err_da);\r",
                    "          return;\r",
                    "        }\r",
                    "      },\r",
                    "      fail:function(result){\r",
                    "        is_free = true;\r",
                    "        beat_try --;\r",
                    "      },\r",
                    "      text:'加载中',\r",
                    "      silent:true,\r",
                    "      trigger:_this,\r",
                    "      check_login:false\r",
                    "    } );\r",
                    "\r",
                    "\r",
                    "  };\r",
                    "\r",
                    "\r",
                    "  window.bind_check_beat_handler_sina = interval_handler = window.setInterval(function(){\r",
                    "    if(is_free){\r",
                    "      tick_beat();\r",
                    "    }\r",
                    "    timeout--;\r",
                    "  },1000);\r",
                    "\r",
                    "\r",
                    "\r",
                    "};\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "\r",
                    "Ext.Viewport.setMasked({\r",
                    "  xtype: 'loadmask',\r",
                    "  message: '加载中，请稍候。',\r",
                    "  transparent:true\r",
                    "});\r",
                    "\r",
                    "var iframe_seek_handler = window.setInterval(function(){\r",
                    "  var $iframe = jQuery('#if_sinaweibo');\r",
                    "  if( $iframe && $iframe.length ){\r",
                    "    clearInterval(iframe_seek_handler);\r",
                    "    Ext.Viewport.unmask();\r",
                    "    init_iframe($iframe);\r",
                    "  }\r",
                    "},1000);\r",
                    "\r",
                    "\r",
                    "\r",
                    ""
                ]
            },
            "designerId": "da0555d6-4a5a-4738-b8d0-38b4c49c244e"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "_p"
                ],
                "fn": "update",
                "implHandler": [
                    "var _this = this;\r",
                    "\r",
                    "\r",
                    "_this.f_pop_refresh = true;\r",
                    "\r",
                    "\r",
                    "var platform = 'sina';\r",
                    "var flag = 'mobile';\r",
                    "var return_url = 'http://popview';//get_return_url(platform);\r",
                    "var token = get_s('token');\r",
                    "\r",
                    "\r",
                    "var x$iframe_con = i$('iframe_con',_this);\r",
                    "var $iframe_con = j$(x$iframe_con);\r",
                    "var con_id = x$iframe_con.getId();\r",
                    "\r",
                    "\r",
                    "var $iframe_con_html = $iframe_con.find('.x-inner');\r",
                    "\r",
                    "var url = build_api('bind_iframe_sina');\r",
                    "url = url + '/?platform='+platform+'&flag='+flag+'&return_url='+return_url+'&token='+token;\r",
                    "\r",
                    "//var $iframe = jQuery('<iframe src=\"about:blank\" scrolling=\"no\" allowtransparency=\"true\" frameborder=\"0\" width=\"100%\" height=\"1000\" name=\"'+con_id+'_iframe\" id=\"'+con_id+'_iframe\"></iframe>');\r",
                    "\r",
                    "//$iframe_con_html.append($iframe);\r",
                    "\r",
                    "//var ref = window.open('bind_loading.html?url='+encodeURIComponent(url), '_blank' ,'location=no');\r",
                    "var ref = window.open(url, '_blank' ,'location=no');\r",
                    "\r",
                    "ref.addEventListener('loadstart', function(event) {\r",
                    "  //alert(event.url);\r",
                    "  if( event.url == 'popview' || event.url == 'http://popview' || event.url == 'http://popview/'  || event.url == 'http://www.popview/'  || event.url == 'www.popview/' || event.url == 'www.popview' ){\r",
                    "    ref.close();\r",
                    "  }\r",
                    "});\r",
                    "\r",
                    "ref.addEventListener('exit', function(event) {\r",
                    "  pop_view(true);\r",
                    "});\r",
                    "\r",
                    "\r",
                    "/*\r",
                    "\r",
                    "window.plugins.ChildBrowser.showWebPage(url,{\r",
                    "  showLocationBar:false,\r",
                    "  showAddress:false,\r",
                    "  showNavigationBar:false\r",
                    "});\r",
                    "\r",
                    "\r",
                    "window.plugins.ChildBrowser.onClose = function () {\r",
                    "  //alert('childBrowser has closed');\r",
                    "  pop_view(true);\r",
                    "};\r",
                    "\r",
                    "window.plugins.ChildBrowser.onLocationChange = function (url) {\r",
                    "  if(url == 'about:blank'){\r",
                    "    window.plugins.ChildBrowser.close();\r",
                    "  }\r",
                    "  //alert('childBrowser has loaded ' + url);\r",
                    "};\r",
                    "\r",
                    "*/\r",
                    "\r",
                    "\r",
                    "/*\r",
                    "\r",
                    "var ref = window.open(url, con_id+'_iframe');\r",
                    "\r",
                    "ref.addEventListener('loadstart', function() { alert('LOAD START '+event.url); });\r",
                    "ref.addEventListener('loadstop', function() { alert('LOAD STOP'); });\r",
                    "ref.addEventListener('loaderror', function() { alert('LOAD ERROR'); });\r",
                    "ref.addEventListener('exit', function() { alert('EXIT'); });\r",
                    "\r",
                    "*/\r",
                    "\r",
                    ""
                ]
            },
            "designerId": "ff1f0fe7-76c9-4e0c-b2ef-07a82031a765"
        }
    ]
}